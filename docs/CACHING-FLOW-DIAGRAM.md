# Caching & Lazy Loading Flow Diagrams

## ğŸ”„ Server-Side Cache Flow

```
User Request â†’ Next.js API Route
                    â†“
              Check Cache?
                â†™     â†˜
            YES        NO
             â†“          â†“
        Return      Query DB
        Cached   â†’  Store in
         Data      Cache (TTL)
             â†˜      â†™
           User receives
          response with
          X-Cache-Status
              header
```

### Example: `/api/categories` Request

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  First Request (Cache MISS)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  GET /api/categories?featured=true&limit=8              â”‚
â”‚           â†“                                              â”‚
â”‚  Cache Key: "categories:true:8"                         â”‚
â”‚           â†“                                              â”‚
â”‚  Cache.get() â†’ null (MISS)                              â”‚
â”‚           â†“                                              â”‚
â”‚  Query MongoDB                                           â”‚
â”‚           â†“                                              â”‚
â”‚  Cache.set(key, data, 10min)                            â”‚
â”‚           â†“                                              â”‚
â”‚  Response: { data: [...], cached: false }               â”‚
â”‚  Headers: X-Cache-Status: MISS                          â”‚
â”‚           Cache-Control: s-maxage=300, swr=600          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Second Request (Cache HIT)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  GET /api/categories?featured=true&limit=8              â”‚
â”‚           â†“                                              â”‚
â”‚  Cache Key: "categories:true:8"                         â”‚
â”‚           â†“                                              â”‚
â”‚  Cache.get() â†’ data (HIT)                               â”‚
â”‚           â†“                                              â”‚
â”‚  Skip MongoDB query                                      â”‚
â”‚           â†“                                              â”‚
â”‚  Response: { data: [...], cached: true }                â”‚
â”‚  Headers: X-Cache-Status: HIT                           â”‚
â”‚           Cache-Control: s-maxage=300, swr=600          â”‚
â”‚                                                          â”‚
â”‚  âš¡ 95% faster response time                            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cache Invalidation (POST/PUT/DELETE)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  POST /api/categories                                    â”‚
â”‚           â†“                                              â”‚
â”‚  Create new category in DB                              â”‚
â”‚           â†“                                              â”‚
â”‚  Cache.delete('categories:null:null')                   â”‚
â”‚  Cache.delete('categories:true:8')                      â”‚
â”‚           â†“                                              â”‚
â”‚  Next GET request will be MISS                          â”‚
â”‚  and fetch fresh data                                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Client-Side Cache Flow (useCachedFetch Hook)

```
Component Mounts
       â†“
useCachedFetch('/api/endpoint', options)
       â†“
Check localStorage
       â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Exists â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Check TTL  â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚    â”‚
    Valid  Expired
       â”‚    â”‚
       â†“    â†“
   Return  Fetch
   Cached   API
    Data     â”‚
       â”‚     â†“
       â”‚  Update
       â”‚  localStorage
       â”‚     â”‚
       â””â”€â”€â”€â”€â”€â”˜
         â†“
    Set component
       state
```

### Example: Fetching Categories with Client Cache

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component Mount (First Time)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  useCachedFetch('/api/categories', {                    â”‚
â”‚    cacheKey: 'categories_v1',                           â”‚
â”‚    cacheTTL: 600000  // 10 minutes                      â”‚
â”‚  })                                                      â”‚
â”‚           â†“                                              â”‚
â”‚  localStorage.getItem('categories_v1') â†’ null           â”‚
â”‚           â†“                                              â”‚
â”‚  fetch('/api/categories')                               â”‚
â”‚           â†“                                              â”‚
â”‚  Response: [Category data]                              â”‚
â”‚           â†“                                              â”‚
â”‚  localStorage.setItem('categories_v1', {                â”‚
â”‚    data: [...],                                          â”‚
â”‚    timestamp: Date.now()                                â”‚
â”‚  })                                                      â”‚
â”‚           â†“                                              â”‚
â”‚  setState({ data, isCached: false })                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component Remount (Within TTL)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  useCachedFetch('/api/categories', {...})               â”‚
â”‚           â†“                                              â”‚
â”‚  localStorage.getItem('categories_v1')                  â”‚
â”‚           â†“                                              â”‚
â”‚  { data: [...], timestamp: 1234567890 }                 â”‚
â”‚           â†“                                              â”‚
â”‚  Check: Date.now() - timestamp < 600000                 â”‚
â”‚           â†“                                              â”‚
â”‚  âœ… Valid - Return cached data                          â”‚
â”‚           â†“                                              â”‚
â”‚  setState({ data, isCached: true })                     â”‚
â”‚                                                          â”‚
â”‚  âš¡ Instant response, no network call                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Manual Refetch                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  const { refetch } = useCachedFetch(...)                â”‚
â”‚           â†“                                              â”‚
â”‚  User clicks "Refresh" button                           â”‚
â”‚           â†“                                              â”‚
â”‚  refetch() called                                        â”‚
â”‚           â†“                                              â”‚
â”‚  Skip cache check (force fetch)                         â”‚
â”‚           â†“                                              â”‚
â”‚  fetch('/api/categories')                               â”‚
â”‚           â†“                                              â”‚
â”‚  Update localStorage with fresh data                    â”‚
â”‚           â†“                                              â”‚
â”‚  setState({ data, isCached: false })                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–¼ï¸ Image Lazy Loading Flow

```
Page Load
    â†“
OptimizedImage Component Renders
    â†“
Create Intersection Observer
    â†“
Observer watches for viewport
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image in    â”‚
â”‚ Viewport?   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
   â”‚  NO   â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚
   Show placeholder
   with spinner
       â”‚
   Wait for scroll...
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
   â”‚  YES  â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚
   Start loading image
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Load State  â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚         â”‚
  Loading   Success   Error
     â”‚         â”‚         â”‚
  Spinner  Fade-in  Fallback
     â”‚         â”‚      Image
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
          â”‚              â”‚
    Image visible  Error message
```

### Example: MenuItemCard Image Loading

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Image Below Viewport (Not Loaded)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  <OptimizedImage                                         â”‚
â”‚    src="/api/images/abc123"                             â”‚
â”‚    alt="Coffee"                                          â”‚
â”‚  />                                                      â”‚
â”‚           â†“                                              â”‚
â”‚  Intersection Observer created                          â”‚
â”‚           â†“                                              â”‚
â”‚  Observer: isInView = false                             â”‚
â”‚           â†“                                              â”‚
â”‚  Render placeholder (gray background)                   â”‚
â”‚  Show spinner animation                                  â”‚
â”‚                                                          â”‚
â”‚  DOM: <div style="background: #e5e7eb">                 â”‚
â”‚         <div class="spinner" />                          â”‚
â”‚       </div>                                             â”‚
â”‚                                                          â”‚
â”‚  Network: No image request yet âš¡                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Scrolls (Image 50px from Viewport)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Intersection Observer triggers                         â”‚
â”‚           â†“                                              â”‚
â”‚  setIsInView(true)                                      â”‚
â”‚           â†“                                              â”‚
â”‚  Component re-renders                                    â”‚
â”‚           â†“                                              â”‚
â”‚  <img src="/api/images/abc123" loading="lazy" />        â”‚
â”‚           â†“                                              â”‚
â”‚  Browser starts downloading image                        â”‚
â”‚           â†“                                              â”‚
â”‚  Network: GET /api/images/abc123                        â”‚
â”‚           â†“                                              â”‚
â”‚  Image loads (onLoad event)                             â”‚
â”‚           â†“                                              â”‚
â”‚  setIsLoaded(true)                                      â”‚
â”‚           â†“                                              â”‚
â”‚  CSS transition: opacity 0 â†’ 1                          â”‚
â”‚           â†“                                              â”‚
â”‚  Smooth fade-in effect (300ms)                          â”‚
â”‚           â†“                                              â”‚
â”‚  Placeholder fades out                                   â”‚
â”‚                                                          â”‚
â”‚  âœ… Image visible without layout shift                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Component Code Splitting Flow

```
App Bundle Build
       â†“
webpack/Next.js detects
React.lazy imports
       â†“
Create separate chunks
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚              â”‚              â”‚
â”‚  main.js     â”‚  slider.js   â”‚  journey.js  â”‚
â”‚  (480KB)     â”‚  (120KB)     â”‚  (150KB)     â”‚
â”‚              â”‚              â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
  Page Load      On Scroll      On Scroll
       â”‚              â”‚              â”‚
       â†“              â†“              â†“
  Immediate      Signature      Journey
   Load          Section        Section
```

### Example: Homepage Component Loading

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Initial Page Load                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Browser requests:                                       â”‚
â”‚  â”œâ”€ main.js (480KB) â¬… Core app bundle                  â”‚
â”‚  â”œâ”€ page.js (80KB)  â¬… Homepage code                    â”‚
â”‚  â””â”€ layout.js (40KB) â¬… Layout code                     â”‚
â”‚                                                          â”‚
â”‚  Total: 600KB                                           â”‚
â”‚                                                          â”‚
â”‚  NOT loaded yet:                                         â”‚
â”‚  â”œâ”€ SignatureDrinksSlider.js (120KB)                   â”‚
â”‚  â”œâ”€ OffersSlider.js (80KB)                             â”‚
â”‚  â””â”€ JourneySection.js (150KB)                          â”‚
â”‚                                                          â”‚
â”‚  Saved: 350KB (-37% bundle size) âš¡                     â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Scrolls to "Signature Drinks" Section              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  <Suspense> boundary reached                            â”‚
â”‚           â†“                                              â”‚
â”‚  Show fallback:                                          â”‚
â”‚  <div className="h-96 animate-pulse" />                 â”‚
â”‚           â†“                                              â”‚
â”‚  React.lazy triggers import                             â”‚
â”‚           â†“                                              â”‚
â”‚  fetch('/SignatureDrinksSlider.js')                     â”‚
â”‚           â†“                                              â”‚
â”‚  Download: 120KB                                         â”‚
â”‚           â†“                                              â”‚
â”‚  Parse & Execute                                         â”‚
â”‚           â†“                                              â”‚
â”‚  Replace fallback with actual component                 â”‚
â”‚           â†“                                              â”‚
â”‚  <SignatureDrinksSlider /> renders                      â”‚
â”‚                                                          â”‚
â”‚  Time: ~200ms (fast 3G) âš¡                              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Network Waterfall Comparison                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  WITHOUT Code Splitting:                                â”‚
â”‚  â”œâ”€ main.js â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (950KB) 2.5s              â”‚
â”‚  â””â”€ Total load: 2.5s                                    â”‚
â”‚                                                          â”‚
â”‚  WITH Code Splitting:                                   â”‚
â”‚  â”œâ”€ main.js â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (480KB) 1.2s âš¡                    â”‚
â”‚  â”œâ”€ slider.js â–ˆâ–ˆâ–ˆ (on scroll) 0.3s                     â”‚
â”‚  â””â”€ journey.js â–ˆâ–ˆâ–ˆâ–ˆ (on scroll) 0.4s                   â”‚
â”‚      Total initial: 1.2s (-52% faster) âš¡               â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Complete Request Flow (All Layers)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER REQUEST                          â”‚
â”‚              GET /api/categories                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CDN / EDGE CACHE                            â”‚
â”‚      (Vercel Edge Cache / CloudFlare)                    â”‚
â”‚                                                          â”‚
â”‚  Cache-Control: s-maxage=300                            â”‚
â”‚  If cached: Return immediately âš¡                        â”‚
â”‚  If not: Forward to Next.js server                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          SERVER-SIDE CACHE (In-Memory)                   â”‚
â”‚                  lib/cache.ts                            â”‚
â”‚                                                          â”‚
â”‚  Check: cache.get('categories:true:8')                  â”‚
â”‚  If HIT: Return cached data (10ms) âš¡                    â”‚
â”‚  If MISS: Query database                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ (Cache MISS)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATABASE QUERY                         â”‚
â”‚                     MongoDB                              â”‚
â”‚                                                          â”‚
â”‚  Category.find({ featured: true })                      â”‚
â”‚    .sort({ order: 1 })                                  â”‚
â”‚    .limit(8)                                             â”‚
â”‚                                                          â”‚
â”‚  Query time: ~100-200ms                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CACHE RESULT (10 min TTL)                   â”‚
â”‚                                                          â”‚
â”‚  cache.set('categories:true:8', data, 600000)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RETURN TO CLIENT                            â”‚
â”‚                                                          â”‚
â”‚  Response Headers:                                       â”‚
â”‚  â”œâ”€ Cache-Control: s-maxage=300, swr=600               â”‚
â”‚  â”œâ”€ X-Cache-Status: MISS                               â”‚
â”‚  â””â”€ Content-Type: application/json                     â”‚
â”‚                                                          â”‚
â”‚  Response Body:                                          â”‚
â”‚  { success: true, data: [...] }                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CLIENT-SIDE CACHE (localStorage)                â”‚
â”‚              hooks/useCachedFetch.ts                     â”‚
â”‚                                                          â”‚
â”‚  Store in localStorage:                                  â”‚
â”‚  {                                                       â”‚
â”‚    data: [...],                                          â”‚
â”‚    timestamp: Date.now()                                â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â”‚  Next component mount: Instant load âš¡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Performance Gains Summary

```
Traditional Approach:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Every request hits DB (200ms)
No image lazy loading (5MB upfront)
All JS loaded upfront (950KB)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total Page Load: ~4.5s
TTI: ~4.5s
LCP: ~3.2s


Optimized Approach:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
90% requests from cache (10ms) âš¡
Images lazy loaded (2MB initial) âš¡
Code split (480KB initial) âš¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total Page Load: ~1.8s (-60%) âš¡
TTI: ~2.8s (-38%) âš¡
LCP: ~1.9s (-41%) âš¡
```

---

**All diagrams represent actual implementation in the codebase!**
